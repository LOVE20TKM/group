# é“¾ç¾¤åç§°æ ¡éªŒè§„åˆ™

## æ¦‚è¿°

LOVE20 Group ç³»ç»Ÿä¸­çš„é“¾ç¾¤åç§°éœ€è¦ä¸¥æ ¼æ ¡éªŒï¼Œä»¥ä¿éšœå®‰å…¨æ€§ã€ä¸€è‡´æ€§ä¸è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æœ¬è§„åˆ™é‡‡å–äº†**å®½æ¾ä½†å®‰å…¨**çš„æ–¹æ¡ˆï¼Œæ”¯æŒå›½é™…åŒ–å­—ç¬¦ï¼ŒåŒæ—¶é¿å…æ»¥ç”¨é£é™©ã€‚

**é‡è¦**ï¼šé“¾ç¾¤åç§°é‡‡ç”¨**å¤§å°å†™ä¸æ•æ„Ÿï¼ˆä»… ASCIIï¼‰**çš„å”¯ä¸€æ€§æ£€æŸ¥ï¼Œå³ä»…å°† ASCII å­—æ¯ `A-Z` è§†ä¸ºä¸ `a-z` ç­‰ä»·ï¼ˆä¾‹å¦‚ `MyGroup`ã€`mygroup`ã€`MYGROUP` è§†ä¸ºåŒä¸€åç§°ï¼Œå…ˆæ³¨å†Œè€…å¾—ï¼‰ã€‚ç³»ç»Ÿä¼šä¿ç•™ç”¨æˆ·æ³¨å†Œæ—¶çš„åŸå§‹å¤§å°å†™ç”¨äºæ˜¾ç¤ºã€‚

**æ³¨æ„**ï¼šç³»ç»Ÿ**ä¸åš Unicode casefold**ï¼Œä¹Ÿ**ä¸åš NFC/NFKC ç­‰ Unicode è§„èŒƒåŒ–**ï¼›é™¤ ASCII `A-Z` å¤–ï¼Œå…¶ä»–å­—ç¬¦æŒ‰ UTF-8 å­—èŠ‚åºåˆ—ç²¾ç¡®æ¯”è¾ƒã€‚

## æ ¡éªŒè§„åˆ™

### âœ… å…è®¸

1. **é•¿åº¦**ï¼š1~64 å­—èŠ‚ï¼ˆUTF-8 ç¼–ç ï¼‰

   - æ³¨æ„ï¼šå•ä¸ª Unicode å­—ç¬¦å¯èƒ½å ç”¨å¤šä¸ªå­—èŠ‚
   - ä¾‹å­ï¼š"ç¾¤"ï¼ˆUTF-8 ä¸‹å ç”¨ 3 å­—èŠ‚ï¼‰

2. **å­—ç¬¦ç±»å‹**ï¼š

   - âœ… å­—æ¯ï¼š`a-z`ï¼Œ`A-Z`
   - âœ… æ•°å­—ï¼š`0-9`
   - âœ… ç‰¹æ®Šç¬¦å·ï¼šæ‰€æœ‰ ASCII å¯æ‰“å°å­—ç¬¦ï¼ˆ0x21-0x7Eï¼Œé™¤ç©ºæ ¼å¤–ï¼‰ï¼ŒåŒ…æ‹¬ `-`ã€`_`ã€`.`ã€`@`ã€`!`ã€`#`ã€`$`ã€`%`ã€`^`ã€`&`ã€`*` ç­‰
   - âœ… Unicode å­—ç¬¦ï¼šä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€å•ç ç‚¹è¡¨æƒ…ç¬¦å·ç­‰
   - âš ï¸ **æ³¨æ„**ï¼šéœ€è¦é›¶å®½è¿æ¥ç¬¦ï¼ˆZWJï¼ŒU+200Dï¼‰çš„å¤åˆ Emojiï¼ˆå¦‚ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ï¼‰ä¸è¢«æ”¯æŒï¼Œå› ä¸º ZWJ å­—ç¬¦å·²è¢«ç¦æ­¢ä»¥é˜²æ­¢æ··æ·†æ”»å‡»ã€‚ä»…æ”¯æŒå•ä¸ªç ç‚¹çš„è¡¨æƒ…ç¬¦å·ï¼ˆå¦‚ ğŸ˜€ã€ğŸ‰ã€â¤ï¸ï¼‰

3. **æ ¼å¼**ï¼š
   - âœ… å¤§å°å†™æ··åˆï¼ˆæ³¨æ„ï¼šå”¯ä¸€æ€§æ£€æŸ¥ä»…å¯¹ ASCII å­—æ¯ä¸åŒºåˆ†å¤§å°å†™ï¼‰
   - âœ… æ··ç”¨ç‰¹æ®Šç¬¦å·

### âŒ æ‹’ç»

1. **ç©ºåç§°**

   - æŠ¥é”™ï¼š`GroupNameEmpty()`

2. **è¶…è¿‡ 64 å­—èŠ‚çš„åç§°**

   - æŠ¥é”™ï¼š`InvalidGroupName()`

3. **ç©ºæ ¼å­—ç¬¦ (0x20 åŠæ‰€æœ‰ Unicode ç©ºæ ¼)**

   - ä¾‹å­ï¼š" Group"ã€"Group "ã€"Group Name"ã€"Group ã€€ Name"ï¼ˆå…¨è§’ç©ºæ ¼ï¼‰
   - æŠ¥é”™ï¼š`InvalidGroupName()`
   - **åŒ…æ‹¬ä½†ä¸é™äºï¼š**
     - U+0020: æ™®é€šç©ºæ ¼ (Space)
     - U+00A0: ä¸æ¢è¡Œç©ºæ ¼ (No-Break Space)
     - U+1680: Ogham ç©ºæ ¼æ ‡è®° (Ogham Space Mark)
     - U+2000-U+200A: å„ç§å®½åº¦çš„ç©ºæ ¼ï¼ˆEn Quad, Em Quad, En Space, Em Space ç­‰ï¼‰
     - U+202F: çª„ä¸æ¢è¡Œç©ºæ ¼ (Narrow No-Break Space)
     - U+205F: ä¸­ç­‰æ•°å­¦ç©ºæ ¼ (Medium Mathematical Space)
     - U+3000: ä¸­æ–‡å…¨è§’ç©ºæ ¼ (Ideographic Space)

4. **æ§åˆ¶å­—ç¬¦ (0x00-0x1F)**

   - åŒ…å«ï¼šæ¢è¡Œç¬¦(`\n`)ã€åˆ¶è¡¨ç¬¦(`\t`)ã€å›è½¦ç¬¦(`\r`) ç­‰
   - æŠ¥é”™ï¼š`InvalidGroupName()`

5. **C1 æ§åˆ¶å­—ç¬¦ (0x80-0x9F)**

   - Latin-1 è¡¥å……ä¸­çš„æ§åˆ¶å­—ç¬¦
   - æŠ¥é”™ï¼š`InvalidGroupName()`

6. **DEL å­—ç¬¦ (0x7F)**

   - æŠ¥é”™ï¼š`InvalidGroupName()`

7. **è¡Œåˆ†éš”ç¬¦å’Œæ®µè½åˆ†éš”ç¬¦**

   - U+2028: è¡Œåˆ†éš”ç¬¦ (Line Separator)
   - U+2029: æ®µè½åˆ†éš”ç¬¦ (Paragraph Separator)
   - æŠ¥é”™ï¼š`InvalidGroupName()`
   - **è¯´æ˜**ï¼šè¿™äº›å­—ç¬¦å¯èƒ½è¢«è§£æä¸ºæ¢è¡Œï¼Œå¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸

8. **æ–¹å‘æ ¼å¼åŒ–å­—ç¬¦**

   - U+061C: é˜¿æ‹‰ä¼¯å­—æ¯æ ‡è®° (Arabic Letter Mark)
   - U+202A-U+202E: åŒå‘æ–‡æœ¬æ ¼å¼åŒ–å­—ç¬¦
     - U+202A: å·¦åˆ°å³åµŒå…¥ (Left-to-Right Embedding)
     - U+202B: å³åˆ°å·¦åµŒå…¥ (Right-to-Left Embedding)
     - U+202C: å¼¹å‡ºæ–¹å‘æ ¼å¼ (Pop Directional Formatting)
     - U+202D: å·¦åˆ°å³è¦†ç›– (Left-to-Right Override)
     - U+202E: å³åˆ°å·¦è¦†ç›– (Right-to-Left Override)
   - æŠ¥é”™ï¼š`InvalidGroupName()`
   - **è¯´æ˜**ï¼šè¿™äº›å­—ç¬¦å¯ç”¨äºåˆ›å»ºè§†è§‰æ¬ºéª—ï¼Œæ”¹å˜æ–‡æœ¬æ˜¾ç¤ºæ–¹å‘

9. **é›¶å®½å­—ç¬¦ï¼ˆZero-Width Charactersï¼‰**
   - é›¶å®½ç©ºæ ¼ (U+200B)
   - é›¶å®½éè¿æ¥ç¬¦ (U+200C)
   - é›¶å®½è¿æ¥ç¬¦ (U+200D)
   - å·¦åˆ°å³æ ‡è®° (U+200E)
   - å³åˆ°å·¦æ ‡è®° (U+200F)
   - ç»„åˆç”¨å­—å½¢è¿æ¥ç¬¦ (U+034F)
   - é›¶å®½ä¸æ¢è¡Œç©ºæ ¼/BOM (U+FEFF)
   - è¯è¿æ¥ç¬¦ (U+2060)
   - è½¯è¿å­—ç¬¦ (U+00AD)
   - æŠ¥é”™ï¼š`InvalidGroupName()`
   - **è¯´æ˜**ï¼šè¿™äº›ä¸å¯è§å­—ç¬¦å¸¸è¢«ç”¨äºæ··æ·†å’Œæ¬ºéª—æ”»å‡»ï¼Œå› æ­¤è¢«å®Œå…¨ç¦æ­¢

## ç¤ºä¾‹

### åˆæ³•é“¾ç¾¤åç§°ç¤ºä¾‹ âœ…

```solidity
"MyGroup"                  // ç®€å• ASCII
"Group-123"                // å«æ•°å­—ä¸çŸ­æ¨ªçº¿
"My_Group.v2"              // å¤šç§ç‰¹æ®Šç¬¦å·
"é“¾ç¾¤åç§°"                 // ä¸­æ–‡
"Groupé“¾ç¾¤"                // ä¸­è‹±æ–‡æ··åˆ
"ğŸ˜€PartyGroup"             // å•ç ç‚¹ Emojiï¼ˆæ”¯æŒï¼‰
"Group@Company"            // å« @ ç¬¦å·
"a"                        // å•å­—ç¬¦
"1234567890123456789012345678901234567890123456789012345678901234" // 64 å­—èŠ‚ï¼ˆæœ€å¤§ï¼‰
```

### å¤§å°å†™ä¸æ•æ„Ÿç¤ºä¾‹

```solidity
// å‡è®¾ "MyGroup" å·²è¢«æ³¨å†Œ
"mygroup"                // å¤±è´¥ï¼šGroupNameAlreadyExists()ï¼ˆä¸ MyGroup å†²çªï¼‰
"MYGROUP"                // å¤±è´¥ï¼šGroupNameAlreadyExists()ï¼ˆä¸ MyGroup å†²çªï¼‰
"mYgRoUp"                // å¤±è´¥ï¼šGroupNameAlreadyExists()ï¼ˆä¸ MyGroup å†²çªï¼‰

// æŸ¥è¯¢æ—¶ä¹Ÿä¸åŒºåˆ†å¤§å°å†™
tokenIdOf("MyGroup")     // è¿”å› token ID
tokenIdOf("mygroup")     // è¿”å›ç›¸åŒçš„ token ID
isGroupNameUsed("MYGROUP") // è¿”å› true

// ä½† groupNameOf() è¿”å›åŸå§‹å¤§å°å†™
groupNameOf(tokenId)     // è¿”å› "MyGroup"ï¼ˆç”¨æˆ·æ³¨å†Œæ—¶çš„åŸå§‹æ ¼å¼ï¼‰
```

### éæ³•é“¾ç¾¤åç§°ç¤ºä¾‹ âŒ

```solidity
""                       // ç©ºå­—ç¬¦ä¸² (GroupNameEmpty)
" Group"                 // é¦–éƒ¨ç©ºæ ¼ (InvalidGroupName)
"Group "                 // å°¾éƒ¨ç©ºæ ¼ (InvalidGroupName)
"Group Name"             // å†…éƒ¨ ASCII ç©ºæ ¼ (InvalidGroupName)
"Groupã€€Name"            // ä¸­æ–‡å…¨è§’ç©ºæ ¼ U+3000 (InvalidGroupName)
"Group\u00A0Name"        // ä¸æ¢è¡Œç©ºæ ¼ (InvalidGroupName)
"Group\u2003Name"        // Em Space (InvalidGroupName)
"Group\nName"            // æ¢è¡Œç¬¦ (InvalidGroupName)
"Group\tName"            // åˆ¶è¡¨ç¬¦ (InvalidGroupName)
"Group\u0080Name"        // C1 æ§åˆ¶å­—ç¬¦ (InvalidGroupName)
"Group\u2028Name"        // è¡Œåˆ†éš”ç¬¦ (InvalidGroupName)
"Group\u2029Name"        // æ®µè½åˆ†éš”ç¬¦ (InvalidGroupName)
"Group\u061CName"        // é˜¿æ‹‰ä¼¯å­—æ¯æ ‡è®° (InvalidGroupName)
"Group\u202EName"        // å³åˆ°å·¦è¦†ç›– (InvalidGroupName)
"Group\u200BName"        // é›¶å®½ç©ºæ ¼ (InvalidGroupName)
"Group\u200CName"        // é›¶å®½éè¿æ¥ç¬¦ (InvalidGroupName)
"Group\u200DName"        // é›¶å®½è¿æ¥ç¬¦ ZWJ (InvalidGroupName)
"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦Group"                // å¤åˆ Emojiï¼ˆå« ZWJï¼‰(InvalidGroupName)
"Group\u034FName"        // ç»„åˆç”¨å­—å½¢è¿æ¥ç¬¦ (InvalidGroupName)
"Group\u00ADName"        // è½¯è¿å­—ç¬¦ (InvalidGroupName)
"\uFEFFGroupName"        // BOMå­—ç¬¦ (InvalidGroupName)
"12345678901234567890123456789012345678901234567890123456789012345" // 65 å­—èŠ‚ (InvalidGroupName)
```

## æŠ€æœ¯è¯´æ˜

### å­—èŠ‚é•¿åº¦ä¸å­—ç¬¦æ•°çš„åŒºåˆ«

64 å­—èŠ‚ä¸Šé™æŒ‡çš„æ˜¯**UTF-8 ç¼–ç ä¸‹çš„å­—èŠ‚æ•°**ï¼Œå¹¶éå­—ç¬¦æ•°é‡ã€‚å³ï¼š

- è‹±æ–‡/æ•°å­—/å¸¸è§ç¬¦å·ï¼šæ¯ä¸ª 1 å­—èŠ‚ï¼Œå¯ç”¨ 64 ä¸ªå­—ç¬¦
- ä¸­æ–‡/æ—¥æ–‡/éŸ©æ–‡ç­‰ CJK å­—ç¬¦ï¼šé€šå¸¸æ¯ä¸ª 3 å­—èŠ‚ï¼Œçº¦ 21 ä¸ªå­—ç¬¦
- Emoji è¡¨æƒ…ï¼šé€šå¸¸æ¯ä¸ª 4 å­—èŠ‚ï¼Œçº¦ 16 ä¸ªå­—ç¬¦
- æ··åˆå†…å®¹ï¼šå¯ç”¨å­—ç¬¦æ•°æ ¹æ®ç»„åˆè€Œå˜åŒ–

### å®ç°è¯´æ˜

å®é™…æ ¡éªŒç”±åˆçº¦å†…éƒ¨ `_isValidGroupName()` å‡½æ•°å®ç°ï¼Œå…¶æ­¥éª¤åŒ…æ‹¬ï¼š

1. æ ¡éªŒå­—èŠ‚é•¿åº¦ä¸º 1~64
2. éå†å­—èŠ‚è¿‡æ»¤ C0 æ§åˆ¶å­—ç¬¦ (0x00-0x1F) å’Œ ASCII ç©ºæ ¼ (0x20)
3. æ‹’ç» DEL å­—ç¬¦ (0x7F)
4. æ£€æµ‹å¹¶æ‹’ç» C1 æ§åˆ¶å­—ç¬¦ (0x80-0x9F)
5. æ£€æµ‹å¹¶æ‹’ç»æ‰€æœ‰ Unicode ç©ºæ ¼å­—ç¬¦ï¼ˆU+00A0ã€U+1680ã€U+2000-U+200Aã€U+202Fã€U+205Fã€U+3000ï¼‰
6. æ£€æµ‹å¹¶æ‹’ç»è¡Œ/æ®µè½åˆ†éš”ç¬¦ï¼ˆU+2028ã€U+2029ï¼‰
7. æ£€æµ‹å¹¶æ‹’ç»æ–¹å‘æ ¼å¼åŒ–å­—ç¬¦ï¼ˆU+061Cã€U+202A-U+202Eï¼‰
8. æ£€æµ‹å¹¶æ‹’ç»é›¶å®½å­—ç¬¦ï¼ˆé€šè¿‡åŒ¹é…ç‰¹å®šçš„ UTF-8 å­—èŠ‚åºåˆ—ï¼‰
9. éªŒè¯ UTF-8 ç¼–ç æœ‰æ•ˆæ€§ï¼ˆæ‹’ç»æ— æ•ˆèµ·å§‹å­—èŠ‚ 0x80-0xC1ã€0xF5-0xFFï¼Œæ£€æµ‹è¿‡é•¿ç¼–ç å’Œæ— æ•ˆä»£ç†å¯¹ï¼‰
10. å…è®¸æ‰€æœ‰å…¶ä»–å­—ç¬¦ï¼ˆåŒ…æ‹¬å¤šå­—èŠ‚ Unicodeï¼‰

### UTF-8 ç¼–ç éªŒè¯

åˆçº¦å®ç°äº†å®Œæ•´çš„ UTF-8 ç¼–ç éªŒè¯ï¼Œä»¥ä¸‹æƒ…å†µä¼šè¢«æ‹’ç»ï¼š

| æƒ…å†µ                          | è¯´æ˜                                                       |
| ----------------------------- | ---------------------------------------------------------- |
| æ— æ•ˆèµ·å§‹å­—èŠ‚ (0x80-0xC1)      | è¿™äº›å­—èŠ‚ä¸èƒ½ä½œä¸º UTF-8 åºåˆ—çš„èµ·å§‹å­—èŠ‚                      |
| æ— æ•ˆèµ·å§‹å­—èŠ‚ (0xF5-0xFF)      | è¶…å‡º UTF-8 ç¼–ç èŒƒå›´çš„å­—èŠ‚                                  |
| è¿‡é•¿ç¼–ç                       | ä½¿ç”¨å¤šäºå¿…è¦å­—èŠ‚æ•°ç¼–ç çš„å­—ç¬¦ï¼ˆå¦‚ç”¨ 2 å­—èŠ‚ç¼–ç  ASCII å­—ç¬¦ï¼‰ |
| UTF-16 ä»£ç†å¯¹ (U+D800-U+DFFF) | è¿™äº›ç ç‚¹åœ¨ UTF-8 ä¸­æ— æ•ˆ                                    |
| è¶…å‡ºèŒƒå›´çš„ç ç‚¹ (> U+10FFFF)   | Unicode æ ‡å‡†ä¸å…è®¸çš„ç ç‚¹                                   |
| ä¸å®Œæ•´çš„å¤šå­—èŠ‚åºåˆ—            | å¤šå­—èŠ‚å­—ç¬¦çš„åç»­å­—èŠ‚ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯                         |

### å¤§å°å†™å¤„ç†

ç³»ç»Ÿé‡‡ç”¨åŒé‡å­˜å‚¨æ–¹æ¡ˆå®ç°å¤§å°å†™ä¸æ•æ„Ÿçš„å”¯ä¸€æ€§æ£€æŸ¥ï¼š

1. **`_groupNames`**ï¼šå­˜å‚¨åŸå§‹åç§°ï¼ˆä¿ç•™ç”¨æˆ·è¾“å…¥çš„å¤§å°å†™ï¼‰
2. **`_normalizedNameToTokenId`**ï¼šå­˜å‚¨å°å†™ç‰ˆæœ¬ç”¨äºå”¯ä¸€æ€§æ£€æŸ¥

**è½¬æ¢è§„åˆ™**ï¼š

- ä»…è½¬æ¢ ASCII å¤§å†™å­—æ¯ `A-Z`ï¼ˆ0x41-0x5Aï¼‰ä¸ºå°å†™ `a-z`ï¼ˆ0x61-0x7Aï¼‰
- ä¸­æ–‡ã€æ—¥æ–‡ã€Emoji ç­‰é ASCII å­—ç¬¦ä¿æŒä¸å˜

**Gas å½±å“**ï¼š

- `_toLowerCase()` å‡½æ•°éå†å­—èŠ‚æ•°ç»„ï¼ŒO(n) å¤æ‚åº¦
- é¢å¤–ä¸€ä¸ª mapping å†™å…¥ï¼Œå¢åŠ çº¦ 20k gas
- å¯¹äº 64 å­—èŠ‚åç§°ï¼Œè½¬æ¢å¼€é”€çº¦ 3-5k gasï¼ˆåŒ…æ‹¬å†…å­˜åˆ†é…å’Œå­—èŠ‚éå†ï¼‰

## å®‰å…¨æ³¨æ„äº‹é¡¹

### è§„åˆ™è®¾è®¡åˆè¡·

1. **æ‹’ç»æ§åˆ¶å­—ç¬¦**ï¼šé˜²æ­¢æ³¨å…¥æ”»å‡»åŠæ˜¾ç¤ºé—®é¢˜ï¼ˆåŒ…æ‹¬ C0ã€C1 æ§åˆ¶å­—ç¬¦ï¼‰
2. **ç¦æ­¢æ‰€æœ‰ç©ºæ ¼**ï¼šåŒ…æ‹¬ ASCII ç©ºæ ¼å’Œæ‰€æœ‰ Unicode ç©ºæ ¼å­—ç¬¦ï¼Œé¿å…æ··æ·†ã€æ¬ºéª—ä¸è¾“å…¥é”™è¯¯
3. **æ‹’ç»åˆ†éš”ç¬¦**ï¼šé˜²æ­¢è¡Œ/æ®µè½åˆ†éš”ç¬¦å¯¼è‡´çš„æ˜¾ç¤ºå¼‚å¸¸
4. **æ‹’ç»æ–¹å‘æ ¼å¼åŒ–**ï¼šé˜²æ­¢åŒå‘æ–‡æœ¬è¦†ç›–æ”»å‡»å’Œè§†è§‰æ¬ºéª—
5. **æ‹’ç»é›¶å®½å­—ç¬¦**ï¼šé˜²æ­¢ä¸å¯è§å­—ç¬¦é€ æˆçš„æ··æ·†å’Œæ¬ºéª—æ”»å‡»
6. **é™åˆ¶é•¿åº¦**ï¼šå‡å°‘ GAS æ¶ˆè€—ä¸å­˜å‚¨è´Ÿæ‹…
7. **UTF-8 å›½é™…åŒ–æ”¯æŒ**ï¼šä¸ºå…¨çƒç”¨æˆ·æä¾›åŸç”Ÿå‘½åä½“éªŒ

### ç©ºæ ¼å­—ç¬¦é˜²æŠ¤

ç³»ç»Ÿå·²å®ç°å¯¹æ‰€æœ‰å¸¸è§ Unicode ç©ºæ ¼å­—ç¬¦çš„æ£€æµ‹å’Œæ‹’ç»ï¼š

| Unicode | åç§°               | UTF-8 ç¼–ç      | è¯´æ˜               |
| ------- | ------------------ | -------------- | ------------------ |
| U+0020  | æ™®é€šç©ºæ ¼           | 0x20           | ASCII ç©ºæ ¼         |
| U+00A0  | ä¸æ¢è¡Œç©ºæ ¼         | 0xC2 0xA0      | No-Break Space     |
| U+1680  | Ogham ç©ºæ ¼æ ‡è®°     | 0xE1 0x9A 0x80 | Ogham Space Mark   |
| U+2000  | En Quad            | 0xE2 0x80 0x80 | En Quad            |
| U+2001  | Em Quad            | 0xE2 0x80 0x81 | Em Quad            |
| U+2002  | En Space           | 0xE2 0x80 0x82 | En Space           |
| U+2003  | Em Space           | 0xE2 0x80 0x83 | Em Space           |
| U+2004  | Three-Per-Em Space | 0xE2 0x80 0x84 | Three-Per-Em Space |
| U+2005  | Four-Per-Em Space  | 0xE2 0x80 0x85 | Four-Per-Em Space  |
| U+2006  | Six-Per-Em Space   | 0xE2 0x80 0x86 | Six-Per-Em Space   |
| U+2007  | Figure Space       | 0xE2 0x80 0x87 | Figure Space       |
| U+2008  | Punctuation Space  | 0xE2 0x80 0x88 | Punctuation Space  |
| U+2009  | Thin Space         | 0xE2 0x80 0x89 | Thin Space         |
| U+200A  | Hair Space         | 0xE2 0x80 0x8A | Hair Space         |
| U+202F  | çª„ä¸æ¢è¡Œç©ºæ ¼       | 0xE2 0x80 0xAF | Narrow No-Break    |
| U+205F  | ä¸­ç­‰æ•°å­¦ç©ºæ ¼       | 0xE2 0x81 0x9F | Medium Math Space  |
| U+3000  | ä¸­æ–‡å…¨è§’ç©ºæ ¼       | 0xE3 0x80 0x80 | Ideographic Space  |

**é˜²æŠ¤åŸç†**ï¼šé€šè¿‡åœ¨å­—èŠ‚çº§åˆ«æ£€æµ‹è¿™äº›å­—ç¬¦çš„ UTF-8 ç¼–ç åºåˆ—ï¼Œå¯æœ‰æ•ˆé˜²æ­¢ï¼š

- è§†è§‰ç›¸åŒä½†å®é™…ä¸åŒçš„åç§°æ¬ºéª—ï¼ˆå¦‚ä½¿ç”¨ä¸åŒç©ºæ ¼å­—ç¬¦ï¼‰
- éšè—å­—ç¬¦å¯¼è‡´çš„å®‰å…¨æ¼æ´
- å‰ç«¯æ˜¾ç¤ºä¸ä¸€è‡´çš„é—®é¢˜
- ç”¨æˆ·è¯¯è¾“å…¥å…¨è§’ç©ºæ ¼ç­‰ä¸æ˜“å¯Ÿè§‰çš„å­—ç¬¦

### è¡Œ/æ®µè½åˆ†éš”ç¬¦é˜²æŠ¤

| Unicode | åç§°       | UTF-8 ç¼–ç      | è¯´æ˜                |
| ------- | ---------- | -------------- | ------------------- |
| U+2028  | è¡Œåˆ†éš”ç¬¦   | 0xE2 0x80 0xA8 | Line Separator      |
| U+2029  | æ®µè½åˆ†éš”ç¬¦ | 0xE2 0x80 0xA9 | Paragraph Separator |

**é˜²æŠ¤åŸç†**ï¼šè¿™äº›å­—ç¬¦è™½ç„¶ä¸æ˜¯ä¼ ç»Ÿçš„æ¢è¡Œç¬¦ï¼Œä½†åœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­å¯èƒ½è¢«è§£æä¸ºæ¢è¡Œï¼Œå¯¼è‡´ï¼š

- æ˜¾ç¤ºå¼‚å¸¸å’Œå¸ƒå±€é”™ä¹±
- éªŒè¯é€»è¾‘ä¸æ˜¾ç¤ºé€»è¾‘ä¸ä¸€è‡´
- æ½œåœ¨çš„æ³¨å…¥æ”»å‡»é£é™©

### æ–¹å‘æ ¼å¼åŒ–å­—ç¬¦é˜²æŠ¤

| Unicode | åç§°           | UTF-8 ç¼–ç      | è¯´æ˜                       |
| ------- | -------------- | -------------- | -------------------------- |
| U+061C  | é˜¿æ‹‰ä¼¯å­—æ¯æ ‡è®° | 0xD8 0x9C      | Arabic Letter Mark         |
| U+202A  | å·¦åˆ°å³åµŒå…¥     | 0xE2 0x80 0xAA | Left-to-Right Embedding    |
| U+202B  | å³åˆ°å·¦åµŒå…¥     | 0xE2 0x80 0xAB | Right-to-Left Embedding    |
| U+202C  | å¼¹å‡ºæ–¹å‘æ ¼å¼   | 0xE2 0x80 0xAC | Pop Directional Formatting |
| U+202D  | å·¦åˆ°å³è¦†ç›–     | 0xE2 0x80 0xAD | Left-to-Right Override     |
| U+202E  | å³åˆ°å·¦è¦†ç›–     | 0xE2 0x80 0xAE | Right-to-Left Override     |

**é˜²æŠ¤åŸç†**ï¼šè¿™äº›åŒå‘æ–‡æœ¬ï¼ˆBidiï¼‰æ ¼å¼åŒ–å­—ç¬¦å¯ä»¥æ”¹å˜æ–‡æœ¬çš„æ˜¾ç¤ºæ–¹å‘ï¼Œè¢«ç”¨äºï¼š

- **è§†è§‰æ¬ºéª—æ”»å‡»**ï¼šæ˜¾ç¤ºçš„æ–‡æœ¬ä¸å®é™…å­—ç¬¦åºåˆ—ä¸åŒ
- **é’“é±¼æ”»å‡»**ï¼šåˆ›å»ºçœ‹ä¼¼åˆæ³•ä½†å®é™…æ¶æ„çš„åç§°
- **åŒå½¢å¼‚ä¹‰æ”»å‡»**ï¼šåˆ©ç”¨æ–¹å‘å˜åŒ–åˆ›å»ºè§†è§‰ä¸Šç›¸åŒçš„ä¸åŒåç§°

**è‘—åæ¡ˆä¾‹**ï¼š2021 å¹´çš„"Trojan Source"æ”»å‡»å°±æ˜¯åˆ©ç”¨è¿™äº›å­—ç¬¦è¿›è¡Œä»£ç æ³¨å…¥ã€‚

### C1 æ§åˆ¶å­—ç¬¦é˜²æŠ¤

| èŒƒå›´      | UTF-8 ç¼–ç      | è¯´æ˜                 |
| --------- | -------------- | -------------------- |
| 0x80-0x9F | 0xC2 0x80-0x9F | Latin-1 è¡¥å……æ§åˆ¶å­—ç¬¦ |

**é˜²æŠ¤åŸç†**ï¼šC1 æ§åˆ¶å­—ç¬¦æ˜¯ Latin-1 å­—ç¬¦é›†ä¸­çš„æ§åˆ¶å­—ç¬¦ï¼Œè™½ç„¶ä¸å¦‚ C0 å¸¸è§ï¼Œä½†åŒæ ·å¯èƒ½å¯¼è‡´ï¼š

- ç»ˆç«¯å’Œæ˜¾ç¤ºå¼‚å¸¸
- ä¸æŸäº›ç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜
- æ½œåœ¨çš„å®‰å…¨é£é™©

### é›¶å®½å­—ç¬¦é˜²æŠ¤

ç³»ç»Ÿå·²å®ç°å¯¹ä»¥ä¸‹é›¶å®½å­—ç¬¦çš„æ£€æµ‹å’Œæ‹’ç»ï¼š

| Unicode | åç§°               | UTF-8 ç¼–ç      |
| ------- | ------------------ | -------------- |
| U+200B  | é›¶å®½ç©ºæ ¼           | 0xE2 0x80 0x8B |
| U+200C  | é›¶å®½éè¿æ¥ç¬¦       | 0xE2 0x80 0x8C |
| U+200D  | é›¶å®½è¿æ¥ç¬¦         | 0xE2 0x80 0x8D |
| U+200E  | å·¦åˆ°å³æ ‡è®°         | 0xE2 0x80 0x8E |
| U+200F  | å³åˆ°å·¦æ ‡è®°         | 0xE2 0x80 0x8F |
| U+034F  | ç»„åˆç”¨å­—å½¢è¿æ¥ç¬¦   | 0xCD 0x8F      |
| U+FEFF  | BOM/é›¶å®½ä¸æ¢è¡Œç©ºæ ¼ | 0xEF 0xBB 0xBF |
| U+2060  | è¯è¿æ¥ç¬¦           | 0xE2 0x81 0xA0 |
| U+00AD  | è½¯è¿å­—ç¬¦           | 0xC2 0xAD      |

**é˜²æŠ¤åŸç†**ï¼šé€šè¿‡åœ¨å­—èŠ‚çº§åˆ«æ£€æµ‹è¿™äº›å­—ç¬¦çš„ UTF-8 ç¼–ç åºåˆ—ï¼Œå¯æœ‰æ•ˆé˜²æ­¢ï¼š

- è§†è§‰ç›¸åŒä½†å®é™…ä¸åŒçš„åç§°æ¬ºéª—
- éšè—å­—ç¬¦å¯¼è‡´çš„å®‰å…¨æ¼æ´
- å‰ç«¯æ˜¾ç¤ºä¸ä¸€è‡´çš„é—®é¢˜

### æ½œåœ¨è¾¹ç¼˜æƒ…å†µ

1. **å³åˆ°å·¦ï¼ˆRTLï¼‰å­—ç¬¦**ï¼šå…è®¸ä½¿ç”¨ï¼Œä½†æ˜¾ç¤ºå¯èƒ½é€ æˆå›°æ‰°

   - å‰ç«¯åº”å¦¥å–„å¤„ç† RTL æ–‡å­—æ–¹å‘
   - æ³¨æ„ï¼šRTL æ ‡è®°ç¬¦ï¼ˆU+200E/U+200Fï¼‰å·²è¢«ç¦æ­¢

2. **åŒå½¢å¼‚ä¹‰æ”»å‡»ï¼ˆHomographï¼‰**ï¼šæœ‰äº›è„šæœ¬ä¸‹å­—ç¬¦æä¸ºç›¸ä¼¼
   - ä¾‹ï¼š"A"ï¼ˆæ‹‰ä¸ï¼‰ä¸ "Ğ"ï¼ˆè¥¿é‡Œå°”ï¼‰
   - ä¾‹ï¼š"0"ï¼ˆæ•°å­—é›¶ï¼‰ä¸ "O"ï¼ˆå­—æ¯ Oï¼‰
   - å»ºè®®åº”ç”¨å±‚å¢åŠ å‰ç«¯æç¤ºä¸é£é™©æé†’ï¼ˆå¦‚ confusables æ£€æµ‹ã€æ··åˆè„šæœ¬æç¤ºã€ç›¸ä¼¼åç§°æç¤ºï¼‰

## é›†æˆæ–¹æœ€ä½³å®è·µ

### å‰ç«¯æ ¡éªŒèŒƒä¾‹

åˆçº¦è°ƒç”¨å‰å»ºè®®å…ˆåœ¨å‰ç«¯åšä¸€æ¬¡æ ¡éªŒï¼š

```javascript
function isValidGroupName(name) {
  // æ ¡éªŒå­—èŠ‚é•¿åº¦ï¼ˆUTF-8 ç¼–ç ï¼‰
  const bytes = new TextEncoder().encode(name);
  if (bytes.length === 0 || bytes.length > 64) return false;

  // æ ¡éªŒ ASCII ç©ºæ ¼å’Œæ§åˆ¶å­—ç¬¦ (U+0000-U+0020, U+007F)
  if (/[\u0000-\u0020\u007F]/.test(name)) return false;

  // æ ¡éªŒ C1 æ§åˆ¶å­—ç¬¦ (U+0080-U+009F)
  if (/[\u0080-\u009F]/.test(name)) return false;

  // æ ¡éªŒæ‰€æœ‰ Unicode ç©ºæ ¼å­—ç¬¦
  const unicodeSpaces = /[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/;
  if (unicodeSpaces.test(name)) return false;

  // æ ¡éªŒè¡Œ/æ®µè½åˆ†éš”ç¬¦
  if (/[\u2028\u2029]/.test(name)) return false;

  // æ ¡éªŒæ–¹å‘æ ¼å¼åŒ–å­—ç¬¦
  const bidiChars = /[\u061C\u202A-\u202E]/;
  if (bidiChars.test(name)) return false;

  // æ ¡éªŒé›¶å®½å­—ç¬¦
  const zeroWidthChars = /[\u200B-\u200F\uFEFF\u2060\u00AD\u034F]/;
  if (zeroWidthChars.test(name)) return false;

  return true;
}
```

### ç”¨æˆ·ä½“éªŒå»ºè®®

1. **å®æ—¶æ ¡éªŒ**ï¼šè¾“å…¥æ—¶å°±ç»™å‡ºåé¦ˆ
2. **å­—èŠ‚è®¡æ•°æç¤º**ï¼šæ˜¾ç¤ºå·²ç”¨/å‰©ä½™å­—èŠ‚ï¼ˆå¦‚ "15/64 å­—èŠ‚"ï¼‰
3. **è¯¦ç»†æŠ¥é”™ä¿¡æ¯**ï¼šå¼•å¯¼ç”¨æˆ·ä¿®æ­£
4. **å±•ç¤ºæœ‰æ•ˆ/æ— æ•ˆæ¡ˆä¾‹**ï¼šå¸®åŠ©ç†è§£è§„åˆ™
5. **å®‰å…¨è­¦å‘Š**ï¼šæé†’ç”¨æˆ·æ³¨æ„ä¸å¯è§å­—ç¬¦å’Œæ–¹å‘æ ¼å¼åŒ–å­—ç¬¦
6. **å¤§å°å†™æç¤º**ï¼šæŸ¥è¯¢æ—¶æé†’ç”¨æˆ·åç§°ä»…å¯¹ ASCII å­—æ¯ä¸åŒºåˆ†å¤§å°å†™

### åˆçº¦åœ°å€é“¸é€ æç¤º

- è‹¥è°ƒç”¨æ–¹ä¸ºåˆçº¦åœ°å€ï¼Œè¯¥åˆçº¦å¿…é¡»å®ç° `IERC721Receiver` æ¥å£ï¼Œå¦åˆ™é“¸é€ ä¼šå¤±è´¥ï¼ˆrevertï¼‰ã€‚
- è¿™æ˜¯å®‰å…¨è®¾è®¡ï¼šé˜²æ­¢ NFT è¢«æ°¸ä¹…é”åœ¨ä¸æ”¯æŒ ERC721 çš„åˆçº¦ä¸­ã€‚

### å¤§å°å†™å¤„ç†ç¤ºä¾‹

```javascript
// é¢„è§ˆåç§°ä¼šè¢« normalize æˆä»€ä¹ˆï¼ˆpure å‡½æ•°ï¼Œä¸æ¶ˆè€— gasï¼‰
const normalized = await contract.normalizedNameOf("MyGroup");
// normalized === "mygroup"

// æŸ¥è¯¢æ—¶ä½¿ç”¨ä»»æ„å¤§å°å†™éƒ½èƒ½æ‰¾åˆ°
const tokenId1 = await contract.tokenIdOf("MyGroup");
const tokenId2 = await contract.tokenIdOf("mygroup");
const tokenId3 = await contract.tokenIdOf("MYGROUP");
// tokenId1 === tokenId2 === tokenId3

// è·å–åŸå§‹åç§°ç”¨äºæ˜¾ç¤º
const originalName = await contract.groupNameOf(tokenId1);
// originalName === "MyGroup" (ç”¨æˆ·æ³¨å†Œæ—¶çš„æ ¼å¼)

// æ£€æŸ¥åç§°æ˜¯å¦å¯ç”¨ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
const isUsed = await contract.isGroupNameUsed("mygroup");
// å¦‚æœ "MyGroup" å·²æ³¨å†Œï¼Œè¿”å› true
```

## åˆçº¦é”™è¯¯æç¤º

| å¼‚å¸¸                       | è§¦å‘åŸå›                                      |
| -------------------------- | -------------------------------------------- |
| `GroupNameEmpty()`         | åç§°ä¸ºç©ºå­—ç¬¦ä¸²                               |
| `InvalidGroupName()`       | åç§°ä¸ç¬¦åˆæ ¡éªŒè§„åˆ™ï¼ˆé•¿åº¦ã€ç©ºæ ¼ã€æ§åˆ¶å­—ç¬¦ç­‰ï¼‰ |
| `GroupNameAlreadyExists()` | é“¾ç¾¤åç§°å·²è¢«æ³¨å†Œï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰             |
